# gitstream.yml
cm_rules:
  # Automatische Label f√ºr √Ñnderungstypen
  - name: Label based on changed files
    actions:
      - type: add-label
        value: 
          - "dependencies" when: any-glob-match(files, ["package.json", "package-lock.json"])
          - "documentation" when: any-glob-match(files, ["**/*.md", "typedoc.json"])
          - "docker" when: any-glob-match(files, [".docker/**", ".devcontainer/**"])
          - "typescript" when: any-glob-match(files, ["src/**", "lib/**", "**/*.ts"])
          - "config" when: any-glob-match(files, ["tsconfig*.json", "eslint.config.js"])
          - "github" when: any-glob-match(files, [".github/**"])

  # Automatische Review-Zuweisung f√ºr CLI-spezifische √Ñnderungen
  - name: Assign reviewers based on file changes
    actions:
      - type: add-reviewers
        reviewers:
          - "team-cli" when: any-glob-match(files, ["src/**", "lib/**"])
          - "team-devops" when: any-glob-match(files, [".docker/**", ".devcontainer/**", "Dockerfile"])
          - "team-security" when: any-glob-match(files, ["package.json", "package-lock.json"])

  # PR-Beschreibung validieren
  - name: Validate PR description
    if:
      - not: pr.description
    actions:
      - type: comment
        content: |
          ‚ö†Ô∏è Bitte f√ºge eine Beschreibung zu deinem Pull Request hinzu, die folgendes enth√§lt:
          - Zweck der √Ñnderung
          - Betroffene CLI-Befehle
          - Breaking Changes (falls vorhanden)

  # Gr√∂√üenbeschr√§nkung f√ºr PRs
  - name: Warn for large PRs
    if:
      - lines.added > 300
    actions:
      - type: comment
        content: "‚ö†Ô∏è Dieser PR ist sehr gro√ü (+{{lines.added}} Zeilen). F√ºr CLI-√Ñnderungen empfehlen wir kleinere, fokussierte PRs."

  # Automatische Approvals f√ºr Dokumentations√§nderungen
  - name: Auto-approve docs changes
    if:
      - all-glob-match(files, ["**/*.md", "typedoc.json"])
      - lines.added < 50
    actions:
      - type: add-label
        value: "auto-approved"
      - type: approve
      - type: comment
        content: "‚úÖ Automatisch approved, da es sich nur um Dokumentations√§nderungen handelt."

  # Blockieren wenn Sicherheitstests fehlschlagen
  - name: Block if security checks failed
    if:
      - check-failed: "GitGuardian scan"
      - check-failed: "Trivy scans"
    actions:
      - type: comment
        content: "üö® Sicherheitschecks fehlgeschlagen! Bitte behebe die Probleme bevor du fortf√§hrst."
      - type: block

  # Besondere Aufmerksamkeit f√ºr Docker-√Ñnderungen
  - name: Highlight Docker changes
    if:
      - any-glob-match(files, [".docker/**", ".devcontainer/**"])
    actions:
      - type: add-label
        value: "infrastructure"
      - type: comment
        content: "üê≥ Docker-√Ñnderungen erkannt - bitte @team-devops zur Review hinzuf√ºgen."

  # Warnung bei √Ñnderungen an Hauptdateien
  - name: Warn for core changes
    if:
      - any-glob-match(files, ["src/index.ts", "lib/**"])
    actions:
      - type: add-label
        value: "core-change"
      - type: comment
        content: "‚ö†Ô∏è Wichtige Kern√§nderung - bitte sorgf√§ltig reviewen!"

pr_defaults:
  # Standard-Reviewer f√ºr CLI-√Ñnderungen
  required_reviewers:
    - "cli-maintainer" when: any-glob-match(files, ["src/**", "lib/**"])
    - "devops-lead" when: any-glob-match(files, [".docker/**", ".devcontainer/**"])

  # Standard-Labels
  labels:
    - "cli"
    - "needs-review"

  # PR-Template f√ºr CLI-√Ñnderungen
  description: |
    ## CLI-√Ñnderungsbeschreibung
    [Welche CLI-Funktionalit√§t wird hinzugef√ºgt/ge√§ndert?]

    ### Betroffene Befehle:
    - [ ] Befehl 1
    - [ ] Befehl 2

    ### Breaking Changes:
    - [ ] Ja (bitte dokumentieren)
    - [ ] Nein

    ### Tests durchgef√ºhrt:
    - [ ] Unit Tests
    - [ ] Manuelle Tests
    - [ ] Beides

    ## Sicherheits√ºberlegungen
    [Gibt es Auswirkungen auf Berechtigungen oder Sicherheit?]
